# üìù Documento de Contexto: Migra√ß√£o JavaFX e Refatora√ß√£o de Backup

**Projeto:** FBUpdateTool (Firebird Update Utility)  
**Data:** 12/12/2025  
**Status:** Funcional (com observa√ß√£o sobre caminhos Docker/Mac)

---

## 1. Vis√£o Geral
Nesta sess√£o, realizamos a migra√ß√£o completa da interface gr√°fica de **Swing** para **JavaFX**, modernizando o visual e a arquitetura. Al√©m disso, reescrevemos o sistema de Backup para ser mais robusto, visual e control√°vel pelo usu√°rio.

---

## 2. Altera√ß√µes Estruturais (Migra√ß√£o JavaFX)

### üì¶ Depend√™ncias (`pom.xml`)
* **Removido:** `flatlaf`, `ikonli-swing`.
* **Adicionado:**
    * `javafx-controls` e `javafx-fxml` (Vers√£o 17.0.8).
    * `ikonli-javafx` e `ikonli-materialdesign2-pack` (Para √≠cones vetoriais modernos).
* **Ajuste:** Configura√ß√£o do plugin `maven-shade-plugin` para garantir que o JAR execut√°vel funcione corretamente com o launcher.

### üèó Arquitetura de Inicializa√ß√£o
* **`Main.java` (Launcher):** Criada uma classe "porteira" que apenas chama o JavaFX. Isso evita erros de m√≥dulo ao criar execut√°veis `.exe` ou `.jar`.
* **`MainApp.java` (Application):** Nova classe principal que estende `javafx.application.Application`, substituindo o antigo `MainFrame`.
* **Threading:** Implementa√ß√£o rigorosa de `Platform.runLater()` para garantir que altera√ß√µes na interface (UI) sejam feitas apenas na thread correta, evitando travamentos.

---

## 3. Melhorias no Sistema de Backup (`BackupService`)

### üõ† Corre√ß√µes T√©cnicas
* **Corre√ß√£o de `String.format`:** Substitu√≠da a formata√ß√£o do nome do arquivo por concatena√ß√£o simples (`+`). Isso resolveu o erro cr√≠tico `Conversion = '.'` que ocorria ao processar nomes de arquivos com pontos.
* **Stream de Sa√≠da:** O m√©todo `performBackup` agora aceita um `OutputStream`. Isso permite desviar o log do Jaybird (Gbak) para qualquer lugar.

### üì∫ Feedback Visual (Console Hacker)
* **`GuiOutputStream.java`:** Criada classe utilit√°ria que intercepta o texto do console e o escreve em um `TextArea` do JavaFX em tempo real.
* **Popup de Progresso:** Ao iniciar o backup, o sistema abre um *Dialog* com fundo preto e texto verde, mostrando o progresso detalhado do Firebird (tabelas sendo salvas) para tranquilizar o usu√°rio.

### üìÇ Tratamento de Erros e Caminhos
* **Retry Logic (L√≥gica de Retentativa):** Se o backup falhar na pasta padr√£o (devido a permiss√µes ou erro de caminho), o sistema captura o erro e abre automaticamente um `DirectoryChooser` pedindo para o usu√°rio indicar onde salvar.
* **Compatibilidade Docker:** Ajuste na string de conex√£o JDBC para diferenciar o caminho local (host) do caminho interno do container (`/firebird/data/`).

---

## 4. Melhorias de Interface e UX

### üé® Estiliza√ß√£o
* **Cores de Sele√ß√£o:** Corrigido o bug onde a sele√ß√£o da lista deixava o texto invis√≠vel. Agora, itens selecionados ficam com fundo **Azul Claro (#BBDEFB)** e texto **Preto**.
* **√çcones de Status:** Adicionados √≠cones visuais para cada estado do script:
    * ‚úÖ Sucesso (Verde)
    * ‚ùå Erro (Vermelho)
    * ‚è≥ Rodando (Azul)
    * ‚ö†Ô∏è Aviso (Laranja)
    * ‚è≠ Pulado (Roxo)

### üéÆ Novos Controles
* **Bot√£o "Apenas Backup":** Permite rodar a rotina de seguran√ßa sem executar nenhum script SQL.
* **Bot√£o "Parar":** Implementada flag `volatile boolean stopRequested`. O usu√°rio pode interromper o processo a qualquer momento. O sistema termina a tarefa atual (para n√£o corromper dados) e para antes da pr√≥xima.

---

## 5. Pend√™ncias Conhecidas (To-Do)

* **Ambiente Docker/Mac:** O mapeamento de volumes entre o Host (Mac) e o Container (Firebird) impede que o servi√ßo de backup (que roda dentro do container) escreva diretamente em pastas do usu√°rio (`/Users/...`) sem configura√ß√£o extra de volumes.
    * *Solu√ß√£o Provis√≥ria:* O sistema tenta, falha, e o usu√°rio deve selecionar uma pasta v√°lida ou aceitar o erro por enquanto.
    * *Solu√ß√£o Futura:* Mapear uma pasta compartilhada fixa no `docker-compose` ou salvar em `/tmp` do container e copiar o arquivo para fora via stream.

---

### Comandos Git Sugeridos

```bash
git add .
git commit -m "refactor: migra√ß√£o JavaFX completa, console de backup visual e corre√ß√£o de paths"
git push origin feature/backup-system